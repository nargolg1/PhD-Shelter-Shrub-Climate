---
title: "Shrub Gradient"
output:
  html_document:
    df_print: paged
  html_notebook: default
  pdf_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, warning = FALSE, message = FALSE)
```


```{r}
#READ DATA
data<-read.csv("C:/Users/Nargol Ghazian/Desktop/PhD-Shelter-Shrub-Climate/shrub gradient/data.csv")
library (dplyr)

#creating new column with volume of the shrub as a hemisphere
data_new <-data %>% mutate(shrub_volume = (0.75*3.14*x*y*z)/1000000)#shrub volume as m^3

#add another column for shrub area
data_finalwide<- data_new %>% mutate (shrub_area = (3.14*x^2)/10000)#shrub area as m^2
na.omit(data_finalwide)

library(tidyr)
data_final<- gather(data_finalwide, response, measurement, NSAT:NSRH:SGT, factor_key=TRUE)
```


```{r}
#EPLORE VISUALS 
library(ggplot2)

ggplot(data_final, aes((response), shrub_volume, fill= response)) + geom_boxplot() + xlab("Response") + ylab ("Shrub Volume (m³)")+ theme_classic()+ theme(axis.text=element_text(size=12))+theme(axis.text.x = element_text(angle = 90))+ stat_summary(fun.y=mean, colour="black", geom="point", shape=18, size=3,show_guide = FALSE)+ theme(panel.border = element_rect(color = "black",
                                    fill = NA,
                                    size = 1))+ theme(axis.title.x=element_blank(),
        axis.text.x=element_blank(),
        axis.ticks.x=element_blank())+ labs(fill = "Measure")

ggplot(data_final, aes((response), shrub_volume, fill= response)) + geom_boxplot() + xlab("Response") + ylab ("Shrub Volume (m³)")+ theme_classic()+ theme(axis.text=element_text(size=12))+theme(axis.text.x = element_text(angle = 90))+ stat_summary(fun.y=mean, colour="black", geom="point", shape=18, size=3,show_guide = FALSE)+ theme(panel.border = element_rect(color = "black",
                                    fill = NA,
                                    size = 1))+ theme(axis.title.x=element_blank(),
        axis.text.x=element_blank(),
        axis.ticks.x=element_blank())+ labs(fill = "Measure")+ facet_wrap(~site_code, scales="free")


ggplot(data_final, aes((shrub_volume), measurement, color=response)) + xlab("Shrub Volume (m³)") + ylab ("Measure")+ theme_classic()+ theme(axis.text=element_text(size=12))+  stat_smooth(method = "lm", formula = y ~ x)+ stat_summary(fun.y=mean, geom="point", size=2, aes(shape = shrub_species))+ labs(color="Measure", shape= "Shrub Species")+ theme(panel.border = element_rect(color = "black",
                                    fill = NA,
                                    size = 1))
ggplot(data_final, aes((shrub_volume), measurement, color=response)) + xlab("Shrub Volume (m³)") + ylab ("Measure")+ theme_classic()+ theme(axis.text=element_text(size=12))+  stat_smooth(method = "lm", formula = y ~ x)+ stat_summary(fun.y=mean, geom="point", size=2, aes(shape = shrub_species))+ labs(color="Measure", shape= "Shrub Species")+ theme(panel.border = element_rect(color = "black",
                                    fill = NA,
                                    size = 1)) + facet_wrap(~site_code, scales = "free")


ggplot(data= data_final, aes(x=site_code, y=shrub_volume, fill=shrub_species)) +
  geom_bar(stat="identity")+ ylab("Shrub Area (m³)") + xlab ("Site")+ theme_classic()+ theme(panel.border = element_rect(color = "black",
                                    fill = NA,
                                    size = 1))+ labs(fill = "Shrub Species")+theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))

ggplot(data_final, aes((site_code), shrub_volume, fill= shrub_species)) + geom_boxplot() + xlab("Site") + ylab ("Shrub Volume (m³)")+ theme_classic()+ theme(axis.text=element_text(size=12))+theme(axis.text.x = element_text(angle = 90))+ stat_summary(fun.y=mean, colour="black", geom="point", shape=18, size=3,show_guide = FALSE)+ theme(panel.border = element_rect(color = "black",
                                    fill = NA,
                                    size = 1))+ labs(fill = "Shrub Species")+ theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))

```




```{r}
#STATISTICAL ANALYSES
#compare shrub volume by species 
t.test(shrub_volume ~ shrub_species, data = data_final)
#compare shrub area by species 
t.test(shrub_area ~ shrub_species, data= data_final)

#models to compare temperature and relative humidity
library(emmeans)

#all the models for shrub volume and microclimate by site
#filter by ephedra only 
data_ephedra <-filter(data_finalwide, shrub_species == "Ephedra californica")

lm1<-glm(NSAT~shrub_volume+ as.factor(site_code), data =data_ephedra)
summary(lm1)
emmeans (lm1, pairwise~site_code)

lm2<-glm(NSRH~shrub_volume+as.factor(site_code), data= data_ephedra)
summary(lm2)
emmeans(lm2, pairwise ~site_code)

lm3<-glm(SGT~shrub_volume+as.factor(site_code), data=data_ephedra)
summary(lm3)
emmeans(lm3, pairwise ~ site_code)


lm4<-glm(shrub_volume ~ as.factor(site_code), data = data_ephedra)
summary (lm4)
emmeans(lm4, pairwise ~site_code)

lm5<-glm(shrub_area ~ as.factor(site_code), data = data_ephedra)
summary (lm5)
emmeans(lm5, pairwise ~site_code)


#all the models for microclimate and microsite differences
lm6 <- glm(NSAT~shrub_volume + as.factor(shrub_species), data= data_finalwide)
summary(lm6)
emmeans(lm6, pairwise ~shrub_species)

lm7 <- glm(NSRH~shrub_volume +as.factor(shrub_species), data= data_finalwide)
summary(lm7)
emmeans(lm7, pairwise ~shrub_species)

lm8<- glm(SGT~shrub_volume +as.factor(shrub_species), data= data_finalwide)
summary(lm8)
emmeans(lm8, pairwise ~shrub_species)

```

```{r}
#EXPLORE DATA DISTRIBUTION
#check normality 
shapiro.test(data_finalwide$NSAT)
hist(data_finalwide$NSAT)#right-skewed
library(ggpubr)
ggqqplot(data_finalwide$NSAT)

shapiro.test(data_finalwide$NSRH)
hist(data_finalwide$NSRH)#right-skewed
library(ggpubr)
ggqqplot(data_finalwide$NSRH)

shapiro.test(data_finalwide$SGT)
hist(data_finalwide$SGT)#unimodal
library(ggpubr)
ggqqplot(data_finalwide$SGT)

shapiro.test(data_final$shrub_volume)
hist(data_final$shrub_volume)#right-skewed
library(ggpubr)
ggqqplot(data_finalwide$shrub_volume)

#check correlation between microclimate variables
cor.test(data_finalwide$NSAT, data_finalwide$NSRH, method = "pearson")#negatively correlated

cor.test(data_finalwide$SGT, data_finalwide$NSRH, method = "pearson")#negatively correlated 

cor.test(data_finalwide$SGT, data_finalwide$NSAT, method = "pearson")#positively correlated

cor.test(data_finalwide$shrub_volume, data_finalwide$shrub_area, method = "pearson")#positively correlated
```


```{r}
#SUPPLEMENTARY PLOTS
ggplot(data_finalwide, aes(NSAT, NSRH))+ geom_point()+ ylab("Relative Humidity (%)")+ xlab("Temperature (°C)")+geom_smooth(method='glm', se=FALSE)+theme_classic()

ggplot(data_finalwide, aes(NSAT, NSRH))+ geom_point()+ ylab("Relative Humidity (%)")+ xlab("Near Surface Air Temperature (°C)")+geom_smooth(method='glm', se=FALSE)+theme_classic()+ facet_wrap(~shrub_species)

ggplot(data_finalwide, aes(NSAT, SGT))+ geom_point()+ ylab("Surface Ground Temperature (°C)")+ xlab("Near Surface Air Temperature (°C)")+geom_smooth(method='glm', se=FALSE)+theme_classic()

ggplot(data_finalwide, aes(NSAT, SGT))+ geom_point()+ ylab("Surface Ground Temperature (°C)")+ xlab("Near Surface Air Temperature (°C)")+geom_smooth(method='glm', se=FALSE)+theme_classic()+ facet_wrap(~shrub_species)

ggplot(data_finalwide, aes(NSRH, SGT))+ geom_point()+ ylab("Surface Ground Temperature (°C)")+ xlab("Relative Humidity (%)")+geom_smooth(method='glm', se=FALSE)+theme_classic()

ggplot(data_finalwide, aes(NSRH, SGT))+ geom_point()+ ylab("Surface Ground Temperature (°C)")+ xlab("Relative Humidity (%)")+geom_smooth(method='glm', se=FALSE)+theme_classic()+ facet_wrap(~shrub_species)

ggplot(data_finalwide, aes(NSRH, SGT))+ geom_point()+ ylab("Surface Ground Temperature (°C)")+ xlab("Relative Humidity (%)")+geom_smooth(method='glm', se=FALSE)+theme_classic()

ggplot(data_finalwide, aes(shrub_volume, shrub_area))+ geom_point()+ ylab("Shrub Area (m²)")+ xlab("Shrub Volume (m³)")+geom_smooth(method='glm', se=FALSE)+theme_classic()

```

